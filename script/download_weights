#!/usr/bin/env python3
"""
Download Chatterbox model weights.

This script is run during the Cog build process to cache the model
weights in the Docker image. It only downloads, does not load models
(to avoid GPU requirements during build).

Requires HF_TOKEN environment variable for gated Persian weights.
"""

from __future__ import annotations

import os
import sys


def main() -> None:
    # Check for HF_TOKEN
    hf_token = os.environ.get("HF_TOKEN")
    if not hf_token:
        print("ERROR: HF_TOKEN environment variable is required for gated model access.")
        print("Set it in your environment or pass it to cog run.")
        sys.exit(1)

    from huggingface_hub import hf_hub_download, snapshot_download

    # Download base Chatterbox model files
    print("Downloading base Chatterbox model from ResembleAI/chatterbox...")
    snapshot_download(
        repo_id="ResembleAI/chatterbox",
        allow_patterns=["*.safetensors", "*.json", "*.pt"],
    )

    # Download Persian fine-tuned weights (gated model)
    print("Downloading Persian weights from Thomcles/Chatterbox-TTS-Persian-Farsi...")
    persian_path = hf_hub_download(
        repo_id="Thomcles/Chatterbox-TTS-Persian-Farsi",
        filename="t3_fa.safetensors",
        token=hf_token,
    )
    print(f"Persian weights downloaded to: {persian_path}")

    print("Download complete!")


if __name__ == "__main__":
    main()
